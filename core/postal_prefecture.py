#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
郵便番号 → 都道府県マッピング
==============================
郵便番号の上位3桁から都道府県を特定するユーティリティ。
store_scraper_v3.py の住所抽出精度改善のフォールバックとして使用。

【使用例】
```python
from core.postal_prefecture import extract_prefecture_from_postal

pref = extract_prefecture_from_postal("100-0001")  # → "東京都"
pref = extract_prefecture_from_postal("〒060-0000")  # → "北海道"
```
"""

import re
from typing import Optional


# 郵便番号上位3桁 → 都道府県マッピング
# 参考: 日本郵便 郵便番号データ
POSTAL_PREFIX_MAP: dict[str, str] = {
    # 北海道 (001-099)
    **{f"{i:03d}": "北海道" for i in range(1, 100)},
    # 秋田県 (010-019) ※ 北海道より優先
    **{f"{i:03d}": "秋田県" for i in range(10, 20)},
    # 岩手県 (020-029)
    **{f"{i:03d}": "岩手県" for i in range(20, 30)},
    # 青森県 (030-039)
    **{f"{i:03d}": "青森県" for i in range(30, 40)},
    # 東京都 (100-209)
    **{f"{i:03d}": "東京都" for i in range(100, 210)},
    # 神奈川県 (210-259)
    **{f"{i:03d}": "神奈川県" for i in range(210, 260)},
    # 千葉県 (260-299)
    **{f"{i:03d}": "千葉県" for i in range(260, 300)},
    # 茨城県 (300-319)
    **{f"{i:03d}": "茨城県" for i in range(300, 320)},
    # 栃木県 (320-329)
    **{f"{i:03d}": "栃木県" for i in range(320, 330)},
    # 埼玉県 (330-369)
    **{f"{i:03d}": "埼玉県" for i in range(330, 370)},
    # 群馬県 (370-379)
    **{f"{i:03d}": "群馬県" for i in range(370, 380)},
    # 長野県 (380-399)
    **{f"{i:03d}": "長野県" for i in range(380, 400)},
    # 山梨県 (400-409)
    **{f"{i:03d}": "山梨県" for i in range(400, 410)},
    # 静岡県 (410-439)
    **{f"{i:03d}": "静岡県" for i in range(410, 440)},
    # 愛知県 (440-499)
    **{f"{i:03d}": "愛知県" for i in range(440, 500)},
    # 岐阜県 (500-509)
    **{f"{i:03d}": "岐阜県" for i in range(500, 510)},
    # 三重県 (510-519)
    **{f"{i:03d}": "三重県" for i in range(510, 520)},
    # 滋賀県 (520-529)
    **{f"{i:03d}": "滋賀県" for i in range(520, 530)},
    # 大阪府 (530-599)
    **{f"{i:03d}": "大阪府" for i in range(530, 600)},
    # 京都府 (600-629)
    **{f"{i:03d}": "京都府" for i in range(600, 630)},
    # 奈良県 (630-639)
    **{f"{i:03d}": "奈良県" for i in range(630, 640)},
    # 和歌山県 (640-649)
    **{f"{i:03d}": "和歌山県" for i in range(640, 650)},
    # 兵庫県 (650-679)
    **{f"{i:03d}": "兵庫県" for i in range(650, 680)},
    # 鳥取県 (680-689)
    **{f"{i:03d}": "鳥取県" for i in range(680, 690)},
    # 島根県 (690-699)
    **{f"{i:03d}": "島根県" for i in range(690, 700)},
    # 岡山県 (700-719)
    **{f"{i:03d}": "岡山県" for i in range(700, 720)},
    # 広島県 (720-739)
    **{f"{i:03d}": "広島県" for i in range(720, 740)},
    # 山口県 (740-759)
    **{f"{i:03d}": "山口県" for i in range(740, 760)},
    # 香川県 (760-769)
    **{f"{i:03d}": "香川県" for i in range(760, 770)},
    # 徳島県 (770-779)
    **{f"{i:03d}": "徳島県" for i in range(770, 780)},
    # 高知県 (780-789)
    **{f"{i:03d}": "高知県" for i in range(780, 790)},
    # 愛媛県 (790-799)
    **{f"{i:03d}": "愛媛県" for i in range(790, 800)},
    # 福岡県 (800-839)
    **{f"{i:03d}": "福岡県" for i in range(800, 840)},
    # 佐賀県 (840-849)
    **{f"{i:03d}": "佐賀県" for i in range(840, 850)},
    # 長崎県 (850-859)
    **{f"{i:03d}": "長崎県" for i in range(850, 860)},
    # 熊本県 (860-869)
    **{f"{i:03d}": "熊本県" for i in range(860, 870)},
    # 大分県 (870-879)
    **{f"{i:03d}": "大分県" for i in range(870, 880)},
    # 宮崎県 (880-889)
    **{f"{i:03d}": "宮崎県" for i in range(880, 890)},
    # 鹿児島県 (890-899)
    **{f"{i:03d}": "鹿児島県" for i in range(890, 900)},
    # 沖縄県 (900-909)
    **{f"{i:03d}": "沖縄県" for i in range(900, 910)},
    # 福井県 (910-919)
    **{f"{i:03d}": "福井県" for i in range(910, 920)},
    # 石川県 (920-929)
    **{f"{i:03d}": "石川県" for i in range(920, 930)},
    # 富山県 (930-939)
    **{f"{i:03d}": "富山県" for i in range(930, 940)},
    # 新潟県 (940-959)
    **{f"{i:03d}": "新潟県" for i in range(940, 960)},
    # 福島県 (960-979)
    **{f"{i:03d}": "福島県" for i in range(960, 980)},
    # 宮城県 (980-989)
    **{f"{i:03d}": "宮城県" for i in range(980, 990)},
    # 山形県 (990-999)
    **{f"{i:03d}": "山形県" for i in range(990, 1000)},
}


def extract_prefecture_from_postal(postal: str) -> Optional[str]:
    """郵便番号から都道府県を推定する

    Args:
        postal: 郵便番号を含む文字列（例: "100-0001", "〒060-0000", "1000001"）

    Returns:
        都道府県名（例: "東京都"）。推定できない場合は None
    """
    if not postal:
        return None

    # 郵便番号のパターンを抽出（〒付き/なし、ハイフン付き/なし）
    match = re.search(r"〒?\s*(\d{3})\-?\d{0,4}", postal)
    if match:
        prefix = match.group(1)
        return POSTAL_PREFIX_MAP.get(prefix)

    return None


# 全47都道府県リスト（参照用）
PREFECTURES = [
    "北海道", "青森県", "岩手県", "宮城県", "秋田県", "山形県", "福島県",
    "茨城県", "栃木県", "群馬県", "埼玉県", "千葉県", "東京都", "神奈川県",
    "新潟県", "富山県", "石川県", "福井県", "山梨県", "長野県", "岐阜県",
    "静岡県", "愛知県", "三重県", "滋賀県", "京都府", "大阪府", "兵庫県",
    "奈良県", "和歌山県", "鳥取県", "島根県", "岡山県", "広島県", "山口県",
    "徳島県", "香川県", "愛媛県", "高知県", "福岡県", "佐賀県", "長崎県",
    "熊本県", "大分県", "宮崎県", "鹿児島県", "沖縄県",
]
