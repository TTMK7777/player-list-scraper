# 店舗情報スクレイピングツール v3.0

企業公式サイトから店舗・教室情報を自動抽出するツール。
**マルチ戦略アプローチ**により、様々なサイト構造に対応。

## 特徴

- **3段階戦略**: 静的解析 → ブラウザ自動操作 → AI推論
- **都道府県別自動巡回**: 数字コード・ローマ字両対応
- **店舗/教室対応**: 小売店から学習塾まで幅広く対応
- **高精度フィルタリング**: ノイズ除去・重複排除

## テスト結果

| サイト | 公式発表 | 抽出結果 | 一致率 |
|--------|----------|----------|--------|
| applenet.co.jp | 263店舗 | 263店舗 | 100% |
| meikogijuku.jp | ~2,000教室 | 1,648教室 | ~82% |

## インストール

```bash
pip install -r requirements.txt
playwright install chromium  # ブラウザ自動操作用（オプション）
```

## 使い方

### GUI版（推奨）

```bash
# Windows
start_v3.bat

# または直接実行
streamlit run app_v3.py
```

ブラウザで http://localhost:8501 が開きます。

### CLI版

```bash
python store_scraper_v3.py "企業名" "https://example.com" --output result.csv
```

## アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│  戦略1: 静的HTML解析（高速・低コスト）                       │
│  ├─ BeautifulSoup + パターンマッチング                      │
│  ├─ 都道府県別ページ自動巡回                                │
│  └─ LLM抽出（Perplexity/Gemini）                           │
├─────────────────────────────────────────────────────────────┤
│  戦略2: ブラウザ自動操作（JavaScript対応）                   │
│  ├─ Playwright でページレンダリング                         │
│  └─ 検索インタラクション対応                                │
├─────────────────────────────────────────────────────────────┤
│  戦略3: AI推論 + 複合アプローチ（最終手段）                  │
│  ├─ サイト構造のLLM分析                                     │
│  ├─ 内部APIエンドポイント推測                               │
│  └─ Perplexity検索で補完                                    │
└─────────────────────────────────────────────────────────────┘
```

## 対応パターン

### URL形式
- `/shop/01/` - 都道府県コード（数字2桁）
- `/school/tokyo/` - 都道府県ローマ字
- `/store/shibuya/` - 地域名

### ページ構造
- 店舗カード形式（div/article内に店舗情報）
- 店舗リンク一覧（/shop/XXXX/, /school/xxx/yyy/）
- JSON-LD構造化データ

## 必要なAPIキー

以下のいずれかを `~/.env.local` に設定：

```bash
PERPLEXITY_API_KEY=pplx-xxxxx  # 推奨
GOOGLE_API_KEY=AIzaSy-xxxxx    # Gemini用
```

## ファイル構成

```
プレイヤーリスト作成/
├── store_scraper_v3.py   # マルチ戦略スクレイピングエンジン
├── app_v3.py             # Streamlit GUI (v3.0)
├── start_v3.bat          # 起動バッチ
├── requirements.txt      # 依存関係
├── store_scraper.py      # 旧CLI版 (v1.0)
├── app.py                # 旧GUI版 (v2.0)
└── start.bat             # 旧版起動バッチ
```

## 制限事項

- 一部のサイトでは住所取得に個別ページ巡回が必要
- JavaScript依存のサイトはPlaywrightが必要
- APIレート制限により大量アクセス時は待機が発生

## バージョン履歴

| Ver | 日付 | 変更内容 |
|-----|------|---------|
| v3.0 | 2025-12-25 | マルチ戦略対応、都道府県ローマ字対応、教室対応 |
| v2.0 | 2025-12-24 | 多段階ページ巡回、LLM抽出 |
| v1.0 | 2025-12-24 | 初版（Playwright + Gemini） |

## ライセンス

Private - Internal Use Only
