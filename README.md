# ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆèª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ  v6.1

ã‚ªãƒªã‚³ãƒ³æ¥­å‹™å‘ã‘ã®**ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆèª¿æŸ»ãƒ»æ­£èª¤ãƒã‚§ãƒƒã‚¯è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«**ã€‚

## ä¸»ãªæ©Ÿèƒ½

### 1. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ­£èª¤ãƒã‚§ãƒƒã‚¯
- æ’¤é€€ãƒ»çµ±åˆãƒ»åç§°å¤‰æ›´ã®**è‡ªå‹•æ¤œå‡º**
- Perplexity/Gemini APIã§**æœ€æ–°æƒ…å ±ã‚’å–å¾—**
- ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›ï¼ˆExcel/CSVï¼‰

### 2. åº—èˆ—ãƒ»æ•™å®¤ã®éƒ½é“åºœçœŒåˆ¥èª¿æŸ»
- AIèª¿æŸ»ï¼ˆæ¨å¥¨ï¼‰: LLMã«ã‚ˆã‚‹Webæ¤œç´¢ãƒ™ãƒ¼ã‚¹ã®èª¿æŸ»
- ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°: ã‚µã‚¤ãƒˆç›´æ¥ã‚¯ãƒ­ãƒ¼ãƒªãƒ³ã‚°ï¼ˆ3æ®µéšæˆ¦ç•¥ï¼‰
- ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰: AIèª¿æŸ» + ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°è£œå®Œ

### 3. å±æ€§èª¿æŸ»ï¼ˆã‚«ãƒ†ã‚´ãƒª/ãƒ–ãƒ©ãƒ³ãƒ‰ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ Ã— å±æ€§ã®ãƒãƒˆãƒªã‚¯ã‚¹è‡ªå‹•ç”Ÿæˆ
- ãƒãƒƒãƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–¹å¼ã§ã‚³ã‚¹ãƒˆæœ€é©åŒ–
- ãƒ—ãƒªã‚»ãƒƒãƒˆå¯¾å¿œï¼ˆã‚¯ãƒ¬ã‚«ãƒ–ãƒ©ãƒ³ãƒ‰ã€å‹•ç”»é…ä¿¡ã‚¸ãƒ£ãƒ³ãƒ«ç­‰ï¼‰

### 4. æ–°è¦å‚å…¥æ¤œå‡º
- æ—¢å­˜ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œãªã„æ–°è¦å‚å…¥ä¼æ¥­ã‚’è‡ªå‹•æ¤œç´¢
- æ¥­ç•Œåˆ¥ã®æœ€æ–°å‚å…¥æƒ…å ±ã‚’å–å¾—

### 5. 3æ®µéšãƒã‚§ãƒƒã‚¯ï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼‰
- Phase 1: å®ŸæŸ»å‰ãƒã‚§ãƒƒã‚¯ï¼ˆæ­£èª¤å…¨ä»¶ + æ–°è¦å‚å…¥ + å±æ€§å…¨ä»¶ï¼‰
- Phase 2: ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç¢ºå®šæ™‚ãƒã‚§ãƒƒã‚¯ï¼ˆæ­£èª¤å…¨ä»¶ + å±æ€§å¤‰æ›´åˆ†ï¼‰
- Phase 3: ç™ºè¡¨å‰ãƒã‚§ãƒƒã‚¯ï¼ˆCRITICALã®ã¿å†æ¤œè¨¼ + æœ€çµ‚ç¢ºèªï¼‰

---

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ç’°å¢ƒè¨­å®š

```bash
# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# APIã‚­ãƒ¼ã‚’è¨­å®šï¼ˆ~/.env.localï¼‰
echo "PERPLEXITY_API_KEY=pplx-xxxxx" >> ~/.env.local
echo "GOOGLE_API_KEY=AIzaSy-xxxxx" >> ~/.env.local
```

### 2. èµ·å‹•

```bash
# æ¨å¥¨: çµ±åˆGUIï¼ˆå…¨5æ©Ÿèƒ½æ­è¼‰ï¼‰
streamlit run app_v5.py

# ãƒãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã§èµ·å‹•
start.bat
```

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|----------|------|
| `start.bat` | ãƒ©ãƒ³ãƒãƒ£ãƒ¼ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠå¼ï¼‰ |
| `start_v5.bat` | v5/v6 çµ±åˆGUIèµ·å‹• |
| `install.bat` | åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— |
| `run_tests.bat` | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |

---

## ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ï¼ˆæ­£èª¤ãƒã‚§ãƒƒã‚¯ï¼‰

| ãƒ¬ãƒ™ãƒ« | æ„å‘³ | å¯¾å¿œ |
|--------|------|------|
| ğŸ”´ ç·Šæ€¥ | æ’¤é€€ãƒ»çµ±åˆ | å³æ™‚ãƒªã‚¹ãƒˆæ›´æ–° |
| ğŸŸ¡ è­¦å‘Š | åç§°å¤‰æ›´ | ãƒªã‚¹ãƒˆæ›´æ–°æ¨å¥¨ |
| ğŸŸ¢ æƒ…å ± | URLå¤‰æ›´ç­‰ | å‚è€ƒæƒ…å ± |
| âœ… æ­£å¸¸ | å¤‰æ›´ãªã— | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸è¦ |

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆä½œæˆ/
â”œâ”€â”€ app_v5.py                    # çµ±åˆGUI (å…¨5æ©Ÿèƒ½)
â”‚
â”œâ”€â”€ core/                        # ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ async_helpers.py         # éåŒæœŸãƒ˜ãƒ«ãƒ‘ãƒ¼ (run_async, å‹•çš„ä¸¦åˆ—åŒ–)
â”‚   â”œâ”€â”€ excel_handler.py         # Excelèª­ã¿æ›¸ã
â”‚   â”œâ”€â”€ llm_client.py            # LLMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (Perplexity/Gemini)
â”‚   â”œâ”€â”€ llm_cache.py             # LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (TTLä»˜ã)
â”‚   â”œâ”€â”€ sanitizer.py             # å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼
â”‚   â”œâ”€â”€ safe_parse.py            # å®‰å…¨ãªå‹å¤‰æ›
â”‚   â”œâ”€â”€ attribute_presets.py     # å±æ€§èª¿æŸ»ãƒ—ãƒªã‚»ãƒƒãƒˆ
â”‚   â”œâ”€â”€ postal_prefecture.py     # éƒµä¾¿ç•ªå·â†’éƒ½é“åºœçœŒå¤‰æ›
â”‚   â”œâ”€â”€ check_history.py         # ãƒã‚§ãƒƒã‚¯å±¥æ­´ç®¡ç† + å·®åˆ†è¨ˆç®—
â”‚   â””â”€â”€ check_workflow.py        # 3æ®µéšãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç®¡ç†
â”‚
â”œâ”€â”€ investigators/               # èª¿æŸ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ base.py                  # ãƒ‡ãƒ¼ã‚¿å‹å®šç¾©
â”‚   â”œâ”€â”€ player_validator.py      # æ­£èª¤ãƒã‚§ãƒƒã‚«ãƒ¼
â”‚   â”œâ”€â”€ store_investigator.py    # åº—èˆ—èª¿æŸ»ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”œâ”€â”€ attribute_investigator.py # å±æ€§èª¿æŸ»ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â””â”€â”€ newcomer_detector.py     # æ–°è¦å‚å…¥æ¤œå‡º
â”‚
â”œâ”€â”€ ui/                          # UIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ common.py                # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ validation_tab.py        # æ­£èª¤ãƒã‚§ãƒƒã‚¯ã‚¿ãƒ–
â”‚   â”œâ”€â”€ store_tab.py             # åº—èˆ—èª¿æŸ»ã‚¿ãƒ–
â”‚   â”œâ”€â”€ attribute_tab.py         # å±æ€§èª¿æŸ»ã‚¿ãƒ–
â”‚   â”œâ”€â”€ newcomer_tab.py          # æ–°è¦å‚å…¥æ¤œå‡ºã‚¿ãƒ–
â”‚   â””â”€â”€ workflow_tab.py          # 3æ®µéšãƒã‚§ãƒƒã‚¯ã‚¿ãƒ–
â”‚
â”œâ”€â”€ store_scraper_v3.py          # åº—èˆ—ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³
â”‚
â”œâ”€â”€ tests/                       # ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ (pytest, 325ä»¶)
â”‚   â”œâ”€â”€ conftest.py              # å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
â”‚   â”œâ”€â”€ test_async_helpers.py
â”‚   â”œâ”€â”€ test_attribute_investigator.py
â”‚   â”œâ”€â”€ test_check_history.py
â”‚   â”œâ”€â”€ test_check_workflow.py
â”‚   â”œâ”€â”€ test_excel_handler.py
â”‚   â”œâ”€â”€ test_llm_cache.py
â”‚   â”œâ”€â”€ test_llm_client.py
â”‚   â”œâ”€â”€ test_newcomer_detector.py
â”‚   â”œâ”€â”€ test_player_validator.py
â”‚   â”œâ”€â”€ test_postal_prefecture.py
â”‚   â”œâ”€â”€ test_safe_parse.py
â”‚   â”œâ”€â”€ test_sanitizer.py
â”‚   â”œâ”€â”€ test_store_investigator.py
â”‚   â””â”€â”€ test_store_scraper_pages_visited.py
â”‚
â”œâ”€â”€ HANDOVER.md                  # å¼•ãç¶™ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ pytest.ini                   # pytestè¨­å®š
â””â”€â”€ requirements.txt             # ä¾å­˜é–¢ä¿‚
```

---

## å¿…è¦ãªAPIã‚­ãƒ¼

`~/.env.local` ã«è¨­å®šï¼š

```bash
PERPLEXITY_API_KEY=pplx-xxxxx  # æ­£èª¤ãƒã‚§ãƒƒã‚¯ãƒ»åº—èˆ—èª¿æŸ»ã«æ¨å¥¨
GOOGLE_API_KEY=AIzaSy-xxxxx    # Geminiç”¨ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
```

---

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/ -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
pytest tests/ --cov=. --cov-report=html
```

---

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´

| Ver | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|-----|------|---------|
| **v6.1** | 2026-02-10 | UIåˆ†é›¢(validation_tab/store_tab)ã€LLMã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€å‹•çš„ä¸¦åˆ—åŒ–ã€ä½æ‰€ç²¾åº¦æ”¹å–„ã€ãƒ†ã‚¹ãƒˆ310ä»¶ |
| **v6.0.1** | 2026-02-09 | 18ä»¶ãƒã‚°ä¿®æ­£ã€safe_parse/async_helpersè¿½åŠ ã€ãƒ†ã‚¹ãƒˆ213ä»¶ |
| **v6.0** | 2026-02-09 | 4æ©Ÿèƒ½è¿½åŠ ï¼ˆå±æ€§èª¿æŸ»ã€æ–°è¦å‚å…¥æ¤œå‡ºã€3æ®µéšãƒã‚§ãƒƒã‚¯ã€UIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ï¼‰ |
| **v5.1** | 2026-02-07 | åº—èˆ—èª¿æŸ»ç²¾åº¦å‘ä¸Šã€å±æ€§èª¿æŸ»ãƒãƒƒãƒåŒ– |
| **v5.0** | 2026-02-06 | v3+v4çµ±åˆã€å±æ€§èª¿æŸ»ãƒ»æ–°è¦å‚å…¥æ¤œå‡ºãƒ»3æ®µéšãƒã‚§ãƒƒã‚¯è¿½åŠ  |
| **v4.1** | 2026-02-05 | ã‚³ãƒ¼ãƒ‰å“è³ªæ”¹å–„ã€pytestå°å…¥ã€ãƒ•ã‚©ãƒ«ãƒ€æ•´ç† |
| **v4.0** | 2026-02-04 | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ­£èª¤ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ |
| v3.0 | 2025-12-25 | ãƒãƒ«ãƒæˆ¦ç•¥ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã€éƒ½é“åºœçœŒå¯¾å¿œ |
| v2.0 | 2025-12-24 | å¤šæ®µéšãƒšãƒ¼ã‚¸å·¡å›ã€LLMæŠ½å‡º |
| v1.0 | 2025-12-24 | åˆç‰ˆï¼ˆPlaywright + Geminiï¼‰ |

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

Private - Internal Use Only

---

è©³ç´°ã¯ [HANDOVER.md](./HANDOVER.md) ã‚’å‚ç…§
