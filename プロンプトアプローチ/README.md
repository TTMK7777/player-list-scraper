# プレイヤーリスト調査 — Gem/GPTs プロンプトアプローチ

プレイヤーリスト作成システム（v6.2）のコア機能を **Gemini Gem / ChatGPT GPTs** に移植したプロンプト＆知識ファイル集です。

## 概要

現行の Streamlit + API システムで培ったプロンプト設計と判定ロジックを、Gem/GPTs の知識ファイルとして再構成しています。Deep Research を活用することで、API コスト不要・非エンジニアでも運用可能です。

### 対象機能（3つ）
1. **Excel 抽出** — アップロードされた Excel からプレイヤー情報を自動抽出
2. **正誤チェック** — 既存プレイヤーの撤退・名称変更・URL変更等を検出
3. **新規参入検出** — 同業界で新しく参入したプレイヤーを検出

### 対象外
- 都道府県別店舗調査（スクレイピング必須のため Gem/GPTs では困難）
- 属性調査（カテゴリ/ブランド別の○×マトリクス）

---

## ファイル構成

| ファイル | 用途 | 設定先 |
|---------|------|--------|
| `system_prompt.md` | メインの指示（システムプロンプト） | Instructions に貼り付け |
| `skill_excel_extraction.md` | Excel 読み取りスキル | 知識ファイルとしてアップロード |
| `skill_player_validation.md` | 正誤チェックスキル | 知識ファイルとしてアップロード |
| `skill_newcomer_detection.md` | 新規参入検出スキル | 知識ファイルとしてアップロード |
| `README.md` | 本ドキュメント（人間用） | アップロード不要 |

---

## GPTs でのセットアップ手順（推奨・先行検証）

### Step 1: GPTs を作成
1. ChatGPT で「GPTs を作成する」を選択
2. 「Configure」タブを開く

### Step 2: Instructions を設定
1. `system_prompt.md` の内容をコピー
2. 「Instructions」欄に貼り付け

### Step 3: 知識ファイルをアップロード
1. 「Knowledge」セクションで「Upload files」をクリック
2. 以下の3ファイルをアップロード:
   - `skill_excel_extraction.md`
   - `skill_player_validation.md`
   - `skill_newcomer_detection.md`

### Step 4: 機能を有効化
- **Code Interpreter**: ON（Excel ファイルの読み取り・生成に必須）
- **Web Browsing**: ON（最新情報の検索に必須）
- DALL-E: OFF（不要）

### Step 5: 保存
- 名前: `プレイヤーリスト調査アシスタント`
- 説明: `オリコンランキング調査用。Excel からプレイヤー抽出、正誤チェック、新規参入検出を支援。`
- 公開範囲: 「Only me」（社内限定）

---

## Gemini Gem でのセットアップ手順

### Step 1: Gem を作成
1. Gemini Advanced で「Gem マネージャー」を開く
2. 「新しい Gem を作成」をクリック

### Step 2: Instructions を設定
1. `system_prompt.md` の内容をコピー
2. 「指示」欄に貼り付け
3. 出力形式の部分を **TSV 形式優先** に読み替え（Gem は Excel 生成非対応）

### Step 3: 知識ファイルをアップロード
1. 「知識」セクションで3つの skill ファイルをアップロード

### Step 4: 保存
- 名前: `プレイヤーリスト調査`

### 注意事項（Gem 固有）
- Gem は **Excel ファイルの生成ができない** → TSV（タブ区切り）形式で出力し、Google Sheets にコピペ
- ファイルアップロードは対応（Excel 読み取りは可能）

---

## Deep Research の使い方

Deep Research を使うと、通常のWeb検索より **大幅に高品質な調査結果** が得られます。
特に正誤チェックと新規参入検出で効果的です。

### GPTs での使い方
1. 会話中に「深く調べてください」「徹底的に調査してください」と指示
2. または、ChatGPT のモード切替で「Deep Research」を選択
3. 調査に数分かかる場合がありますが、結果の品質は大幅に向上します

### Gemini Gem での使い方
1. Gemini Advanced の入力欄横にある「Deep Research」ボタンをクリック
2. または、プロンプトに「Deep Research で調べてください」と追記
3. 調査計画が提示されるので、確認して「開始」をクリック

### Deep Research が特に効果的なケース
- 正誤チェック対象が10件以上ある場合
- マイナーな業界でプレイヤー情報が少ない場合
- 新規参入の網羅性を高めたい場合

---

## 使い方（典型的な会話フロー）

### Step 1: 初期設定
```
ユーザー: 2026年のクレジットカードランキング用のプレイヤーリストです。
         [Excelファイルをアップロード]
```
→ AI が Excel からプレイヤー情報を自動抽出し、一覧を表示

### Step 2: 正誤チェック
```
ユーザー: このリストの正誤チェックをしてください。撤退や名称変更がないか確認お願いします。
```
→ AI が各プレイヤーをWeb検索し、判定アイコン付きの結果テーブルを表示

### Step 3: 新規参入検出
```
ユーザー: 同じクレジットカード業界で、2025年以降に新規参入したプレイヤーはありますか？
```
→ AI がWeb検索で新規参入候補を検出し、情報源URL付きで報告

### Step 4: 結果のエクスポート（GPTs の場合）
```
ユーザー: チェック結果をExcelにまとめてください。
```
→ AI が Code Interpreter で Excel ファイルを生成し、ダウンロードリンクを提供

---

## 現行 Streamlit システムとの機能比較

| 機能 | Streamlit システム | GPTs | Gem |
|------|-------------------|------|-----|
| Excel 抽出 | ✅ 自動検出 | ✅ Code Interpreter | ✅ 読み取り可 |
| 正誤チェック | ✅ Perplexity API | ✅ Web検索/Deep Research | ✅ Deep Research |
| 新規参入検出 | ✅ Perplexity API | ✅ Web検索/Deep Research | ✅ Deep Research |
| 店舗調査 | ✅ AI+スクレイピング | ❌ 非対応 | ❌ 非対応 |
| 属性調査 | ✅ AI調査 | ❌ 非対応 | ❌ 非対応 |
| Excel 出力 | ✅ openpyxl | ✅ Code Interpreter | ❌ TSVコピペ |
| バッチ処理 | ✅ 並列実行 | 🟡 逐次処理 | 🟡 逐次処理 |
| 3段階ワークフロー | ✅ 履歴管理付き | ❌ 手動管理 | ❌ 手動管理 |
| API コスト | 💰 Perplexity課金 | ✅ ChatGPT Plus内 | ✅ Gemini Advanced内 |
| 運用の手軽さ | 🟡 エンジニア必要 | ✅ 誰でも使える | ✅ 誰でも使える |

---

## 制限事項

1. **店舗調査は非対応** — Webスクレイピングが必要なため、Gem/GPTs では実現困難
2. **バッチ処理の制約** — 大量プレイヤー（50件超）の一括チェックは時間がかかる。10-20件ずつの分割推奨
3. **履歴管理なし** — 3段階ワークフローの自動差分比較は非対応。手動で前回結果と比較
4. **URL自動検証なし** — 現行システムの HEAD リクエストによるURL生存確認は非対応。情報源URLで代替
5. **ハルシネーションリスク** — 特に新規参入検出では、AI が実在しないサービスを回答する可能性あり。必ず情報源URLを確認

---

## トラブルシューティング

### Excel が読み取れない
- Excel ファイル形式が `.xlsx` であることを確認（`.xls` は非対応の場合あり）
- シートが複数ある場合は、対象シートを指定してください
- パスワード保護されたファイルは事前に解除

### 正誤チェックの精度が低い
- Deep Research モードを使うと精度が大幅に向上します
- 業界名を具体的に指定してください（「カード」→「クレジットカード」）
- 件数が多い場合は10-20件ずつに分割

### 新規参入が検出されない
- 検索対象の年度を広めに設定（例: 2024年以降）
- 「比較サイトも含めて調べてください」と追加指示
- Deep Research を使うとより網羅的に検出可能

### GPTs で Excel が生成されない
- Code Interpreter が有効になっているか確認
- 「Excelファイルとしてダウンロードできるようにしてください」と明示的に指示
